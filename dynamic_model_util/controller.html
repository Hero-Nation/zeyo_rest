<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>컨트롤러 시뮬레이터</title>
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="svg.js"></script>
<script>
	var dm = dm || {};

	var MAIN_CANVAS = null;

	var import_model = function() {

		if (MAIN_CANVAS != null) {
			MAIN_CANVAS.clear();
		} else {
			MAIN_CANVAS = SVG('MAIN_CANVAS');
		}

		dm = $("#input_dm").val();
		dm = $.trim(dm);
		if (dm == "") {
			alert("수치 모델을 입력해주세요!");
			return;
		}
		dm = JSON.parse(dm);

		draw_model(dm);

	};

	var export_model = function() {

	};
	
	var find_center_xy = function(p_dm){
		
		var max_x = 0;
		var max_y = 0;
		
		for ( var unit_index in p_dm.dynamic_model_element) {
			
			var this_e = p_dm.dynamic_model_element[unit_index];
	 
			if (this_e.start.x > max_x) {
				max_x = this_e.start.x;
			}

			if (this_e.end.x > max_x) {
				max_x = this_e.end.x;
			}

			if (this_e.start.y > max_y) {
				max_y = this_e.start.y;
			}

			if (this_e.end.x > max_y) {
				max_y = this_e.end.y;
			}
			
		}

		return {
			x : max_x / 2,
			y : max_y / 2
		};
	}

	var move_center = function() {

		var center_x = $("#center_x").val();
		var center_y = $("#center_y").val();
		var center_ratio = $("#center_ratio").val();

		if (center_x == null) {
			alert("새로운 중심점 X 값을 넣어주세요!");
			return;
		}

		if (center_y == null) {
			alert("새로운 중심점 Y 값을 넣어주세요!");
			return;
		}

		if (center_ratio == null) {
			alert("새로운 비율 값을 넣어주세요!");
			return;
		}

		var move_gap = {};

		move_gap.x = center_x - dm.center.x;
		move_gap.y = center_y - dm.center.y;

		var center = {
			x : center_x,
			y : center_y
		};

		var clone_dm = $.extend(true, {}, dm);

		for ( var data_index in clone_dm.dynamic_model_element) {
			var element = clone_dm.dynamic_model_element[data_index];
			var move_element = move_element_data(element, move_gap);
			//clone_dm.dynamic_model_element[data_index] = move_element;
			clone_dm.dynamic_model_element[data_index] = scale_element_data(center,move_element,center_ratio);
		}

		draw_model(clone_dm);
		
		clone_dm.center = center;
		
		$("#output_dm").val(JSON.stringify(clone_dm));
	};

	var draw_model = function(p_dynamic_model) {
		console.log("draw_model");
		console.dir(p_dynamic_model);
		MAIN_CANVAS.clear();

		var element_data = p_dynamic_model.dynamic_model_element;

		for ( var data_index in element_data) {

			var element = element_data[data_index];
			console.dir(element);
			var flat_data = flat_element_data(element);

			if (element.type == "path") {

				var path = MAIN_CANVAS.path(flat_data);
				path.fill('none');
				path.stroke({
					color : '#60f',
					width : 2,
					linecap : 'round',
					linejoin : 'round'
				});

			} else if (element.type == "line") {

				var line = MAIN_CANVAS.line(flat_data).stroke({
					color : '#f06',
					width : 2
				});

			}
		}

	};

	var get_point_by_ratio2_test = function() {

		MAIN_CANVAS = SVG('MAIN_CANVAS');

		var p_center = {
			x : 30,
			y : 50
		};

		var p_original_point = {
			x : 0,
			y : 0
		};

		/*
		x1 : 10.00
		controller.html:246 y1 : 50.00
		controller.html:247 x2 : 0.00
		controller.html:248 y2 : 0.00
		controller.html:249 두점의 길이 : 50.99019513592785
		controller.html:250 비율만큼 늘어난 길이 : 101.98
		controller.html:251 비율만큼 늘어난 길이의 제곱 : 10399.00
		controller.html:401 기울기 : 5
		controller.html:411 a : 26
		controller.html:412 b : 480
		controller.html:413 c : -7799
		controller.html:429 eq_x1 : 10.39
		controller.html:430 eq_y1 : 51.95
		controller.html:431 eq_x2 : -28.86
		controller.html:432 eq_y2 : -144.3
		controller.html:452 execution time : 9 ms
		
		
		 */
		/*
		
		
		var p_center = {
			x : 0,
			y : 0
		}; 
		
		var p_original_point = { 	
			x : 30,
			y : 50
		}; 
		
		

		
		x1 : 0.00
		controller.html:245 y1 : 0.00
		controller.html:246 x2 : 10.00
		controller.html:247 y2 : 50.00
		controller.html:248 두점의 길이 : 50.99019513592785
		controller.html:249 비율만큼 늘어난 길이 : 101.98
		controller.html:250 비율만큼 늘어난 길이의 제곱 : 10399.00
		controller.html:400 기울기 : 5
		controller.html:410 a : 26
		controller.html:411 b : 0
		controller.html:412 c : -10399
		controller.html:428 eq_x1 : 20.00
		controller.html:429 eq_y1 : 100
		controller.html:430 eq_x2 : -20.00
		controller.html:431 eq_y2 : -100
		controller.html:451 execution time : 9 ms
		
		
		
		 */

		var p_ratio = 2;

		/* 		var p_original_point = {
		 x : -120,
		 y : 130
		 };
		
		 var p_original_point = {
		 x : -120,
		 y : -130
		 };
		
		 var p_original_point = {
		 x : 120,
		 y : -130
		 };
		 */

		var d = new Date();
		var start = d.getMilliseconds();

		var target_x = null;
		var target_y = null;

		console.log("시작점 ");
		console.log(p_center);

		console.log("끝점 ");
		console.log(p_original_point);

		console.log("비율 ");
		console.log(p_ratio);

		// scale 적용전의 두점을 거리를 구한다.

		var original_length = distants_on_two_point(p_center, p_original_point);

		// scale이 적용된 거리

		var scale_length = original_length * p_ratio;
		scale_length = scale_length.toFixed(2);
		var scale_length_pow = Math.floor(scale_length * scale_length);
		scale_length_pow = scale_length_pow.toFixed(2);

		var x1 = Number(p_center.x).toFixed(2);
		var y1 = Number(p_center.y).toFixed(2);

		var x2 = Number(p_original_point.x).toFixed(2);
		var y2 = Number(p_original_point.y).toFixed(2);

		console.log("x1 : " + x1);
		console.log("y1 : " + y1);
		console.log("x2 : " + x2);
		console.log("y2 : " + y2);
		console.log("두점의 길이 : " + original_length);
		console.log("비율만큼 늘어난 길이 : " + scale_length);
		console.log("비율만큼 늘어난 길이의 제곱 : " + scale_length_pow);

		/*
		
		방정식 1 
		
			eq_y = ( ( y2 - y1 ) / ( x2 - x1 ) ) * ( eq_x - x1 ) + y1;
		
		방정식 2
		
			(eq_x - x1) * (eq_x - x1) + (eq_y - y1) *  (eq_y - y1) - scale_length_pow = 0;
		
		
		근의 공식
		
		    ax2 + bx + c = 0 ;
		
		 */

		var a = 0;
		var b = 0;
		var c = 0;
		var eq_y = 0;

		var eq_x1 = 0;
		var eq_x2 = 0;

		var eq_y1 = 0;
		var eq_y2 = 0;

		if (x2 == x1) {

			/*
			
			 * 방정식 1 
			
			ex_x = x1;
			
			
			 * 방정식 2
			
			
			eq_y * eq_y - 2 * y1 * eq_y + y1 * y1 = 0
			
			
			 * 근의 공식 변수
			
			a = 1 ;
			
			b = -2 * y1;
			
			c = y1 * y1 - scale_length_pow;
			
			 */

			a = 1;

			b = -2 * y1;

			c = y1 * y1 - scale_length_pow;

			eq_x1 = x1;
			eq_x1 = x2;

			console.log("a : " + a);
			console.log("b : " + b);
			console.log("c : " + c);

			eq_y1 = (-b + Math.sqrt(b * b - (4 * a * c))) / (2 * a);
			eq_y1 = Number(eq_y1).toFixed(2);
			eq_y2 = (-b - Math.sqrt(b * b - (4 * a * c))) / (2 * a);
			eq_y2 = Number(eq_y2).toFixed(2);

		} else {

			/*
			
			 
			
			방정식 1 
			
				eq_y = ( ( y2 - y1 ) / ( x2 - x1 ) ) * ( eq_x - x1 ) + y1;
			
			
			기울기
			
				var eq1_slope = (y2 - y1)/(x2 - x1);
			
			
				eq_y = eq1_slope * (eq_x - x1) + y1;
				
				eq_y = eq1_slope * eq_x - eq1_slope * x1 + y1;
			
			
			방정식 2
			
				(eq_x - x1) * (eq_x - x1) + (eq_y - y1) * (eq_y - y1) - scale_length_pow = 0;
			
			-------------------------------------------------------------------------------------------------------------------------------------------------------
			
			(eq_y - y1) * (eq_y - y1) 	   수식 풀이 버전 1
			   
			   
			
			eq_y - y1 = eq1_slope * eq_x - eq1_slope * x1 + y1 - y1 ;
			
			eq_y - y1 = eq1_slope * eq_x - eq1_slope * x1;
			
			   
			(eq1_slope * eq_x - eq1_slope * x1 ) * (eq1_slope * eq_x - eq1_slope * x1 ) 
			
			
			= eq1_slope * eq_x * eq1_slope * eq_x     -     2 * eq1_slope * x1 * eq1_slope * eq_x      +       eq1_slope * x1 * eq1_slope * x1
			
			= eq1_slope * eq1_slope * eq_x * eq_x     -     2 * eq1_slope * eq1_slope * x1 * eq_x      +       eq1_slope * eq1_slope * x1 * x1
			
			
			~~~~~~~~~~~~~~~~~~
			
			
			(eq_x - x1) * (eq_x - x1) + (eq_y - y1) * (eq_y - y1)
			
			
			= eq_x * eq_x                               -     2 * x1 * eq_x                                +       x1 * x1 
			
			+ eq1_slope * eq1_slope * eq_x * eq_x       -     2 * eq1_slope * eq1_slope * x1 * eq_x        +       eq1_slope * eq1_slope * x1 * x1
			
			
			= (1 +  eq1_slope * eq1_slope)(eq_x * eq_x) - 2 * (x1 + eq1_slope * eq1_slope * x1 ) * eq_x  + ( 1 + eq1_slope * eq1_slope)( x1 * x1);
			   
			
				a = (1 +  eq1_slope * eq1_slope);
				b = -2 * x1 -2 * eq1_slope * eq1_slope * x1 
				c = (1 + eq1_slope * eq1_slope)(x1 * x1);
			
			
			근의 공식
			
			    ax2 + bx + c = 0 ;
			
			 */

			var eq1_slope = (y2 - y1) / (x2 - x1);

			console.log("기울기 : " + eq1_slope);

			a = 1 + eq1_slope * eq1_slope;

			b = -2 * x1 - 2 * eq1_slope * eq1_slope * x1;

			c = x1 * x1 + eq1_slope * eq1_slope * x1 * x1 - scale_length_pow;

			console.log("a : " + a);
			console.log("b : " + b);
			console.log("c : " + c);

			eq_x1 = (-b + Math.sqrt(b * b - (4 * a * c))) / (2 * a);
			eq_x1 = Number(eq_x1).toFixed(2);
			eq_x2 = (-b - Math.sqrt(b * b - (4 * a * c))) / (2 * a);
			eq_x2 = Number(eq_x2).toFixed(2);

			var eq1_slope = (y2 - y1) / (x2 - x1);

			eq_y1 = (eq1_slope * eq_x1) - (eq1_slope * x1) + Number(y1);
			eq_y2 = (eq1_slope * eq_x2) - (eq1_slope * x1) + Number(y1);

		}

		console.log("eq_x1 : " + eq_x1);
		console.log("eq_y1 : " + eq_y1);
		console.log("eq_x2 : " + eq_x2);
		console.log("eq_y2 : " + eq_y2);

		var center_axis_gap = 400;
		var circle_size = 6;

		var center_svg = MAIN_CANVAS.circle(circle_size).fill('red').move(
				Number(p_center.x) + Number(center_axis_gap),
				Number(p_center.y) + Number(center_axis_gap));
		var original_point_svg = MAIN_CANVAS.circle(circle_size).fill('blue')
				.move(Number(p_original_point.x) + Number(center_axis_gap),
						Number(p_original_point.y) + Number(center_axis_gap));
		var ratio_point_1_svg = MAIN_CANVAS.circle(circle_size).fill('green')
				.move(Number(eq_x1) + Number(center_axis_gap),
						Number(eq_y1) + Number(center_axis_gap));
		var ratio_point_2_svg = MAIN_CANVAS.circle(circle_size).fill('black')
				.move(Number(eq_x2) + Number(center_axis_gap),
						Number(eq_y2) + Number(center_axis_gap));

		var d = new Date();
		var end = d.getMilliseconds();

		console.log("execution time : " + (end - start) + " ms");

	}

	var circlle_test = function() {

		MAIN_CANVAS = SVG('MAIN_CANVAS');
		MAIN_CANVAS.clear();

		var center = {x : 390,y:390};
		var rect1 = MAIN_CANVAS.rect(10, 10).fill("red");
		var rect2 = MAIN_CANVAS.rect(10, 10).fill("blue");
 
		//var path = MAIN_CANVAS.path(" M 100, 100  m -75, 0  a 75,75 0 1,0 150,0 a 75,75 0 1,0 -150,0"); // 원
		var path = MAIN_CANVAS.path("M0,100 Q50,-50 100,100 T200,100"); 
		//var path = MAIN_CANVAS.path("M17,42 L117,42 V142 H17 Z");
		//var path = MAIN_CANVAS.path("M 100 260 T 105 121 T 280 330 Z");
		 path.center(center.x,center.y);
		var length = path.length()
		  
		path.fill('none').stroke({width:1, color: '#ccc'})
		
		var duration = 10000

		path.animate(duration).during(function(pos, morph, eased) {
			//console.log(pos+":"+ morph+":"+eased);
			var target = path.pointAt(eased * length);
			var new_position = get_point_by_ratio(center,target,2);
			
			console.log(target.x + " "+target.y);
			console.dir(new_position);
			rect1.center(target.x,target.y);
			rect2.center(new_position.x,new_position.y);
			//
			 
		});

	}

	var get_point_by_ratio = function(p_center, p_original_point, p_ratio) {
 

		var target_x = null;
		var target_y = null; 

		// scale 적용전의 두점을 거리를 구한다.

		var original_length = distants_on_two_point(p_center, p_original_point);

		// scale이 적용된 거리

		var scale_length = original_length * p_ratio;
		scale_length = scale_length.toFixed(2);
		var scale_length_pow = Math.floor(scale_length * scale_length);
		scale_length_pow = scale_length_pow.toFixed(2);

		var x1 = Number(p_center.x).toFixed(2);
		var y1 = Number(p_center.y).toFixed(2);

		var x2 = Number(p_original_point.x).toFixed(2);
		var y2 = Number(p_original_point.y).toFixed(2);
 
		var a = 0;
		var b = 0;
		var c = 0;
		var eq_y = 0;

		var eq_x1 = 0;
		var eq_x2 = 0;

		var eq_y1 = 0;
		var eq_y2 = 0;

		if (x2 == x1) {
 
			a = 1;

			b = -2 * y1;

			c = y1 * y1 - scale_length_pow;

			eq_x1 = x1;
			eq_x1 = x2;
 

			eq_y1 = (-b + Math.sqrt(b * b - (4 * a * c))) / (2 * a);
			eq_y1 = Number(eq_y1).toFixed(2);
			eq_y2 = (-b - Math.sqrt(b * b - (4 * a * c))) / (2 * a);
			eq_y2 = Number(eq_y2).toFixed(2);

		} else {
 

			var eq1_slope = (y2 - y1) / (x2 - x1); 

			a = 1 + eq1_slope * eq1_slope;

			b = -2 * x1 - 2 * eq1_slope * eq1_slope * x1;

			c = x1 * x1 + eq1_slope * eq1_slope * x1 * x1 - scale_length_pow; 

			eq_x1 = (-b + Math.sqrt(b * b - (4 * a * c))) / (2 * a);
			eq_x1 = Number(eq_x1).toFixed(2);
			eq_x2 = (-b - Math.sqrt(b * b - (4 * a * c))) / (2 * a);
			eq_x2 = Number(eq_x2).toFixed(2);

			var eq1_slope = (y2 - y1) / (x2 - x1);

			eq_y1 = (eq1_slope * eq_x1) - (eq1_slope * x1) + Number(y1);
			eq_y2 = (eq1_slope * eq_x2) - (eq1_slope * x1) + Number(y1);

		}
 
  		if(x2 >= x1){
  			return {
  					x : eq_x1,
  					y : eq_y1
  				}; 
  		}else{
  			return {
  					x : eq_x2,
  					y : eq_y2
  				}; 
  		}
 

	}

	var get_point_by_extension = function(p_center, p_original_point,
			p_extension) {

		var target_x = null;
		var target_y = null; 

		// scale 적용전의 두점을 거리를 구한다.

		var original_length = distants_on_two_point(p_center, p_original_point);

		// scale이 적용된 거리

		var scale_length = original_length + p_extension;
		scale_length = scale_length.toFixed(2);
		var scale_length_pow = Math.floor(scale_length * scale_length);
		scale_length_pow = scale_length_pow.toFixed(2);

		var x1 = Number(p_center.x).toFixed(2);
		var y1 = Number(p_center.y).toFixed(2);

		var x2 = Number(p_original_point.x).toFixed(2);
		var y2 = Number(p_original_point.y).toFixed(2);
 
		var a = 0;
		var b = 0;
		var c = 0;
		var eq_y = 0;

		var eq_x1 = 0;
		var eq_x2 = 0;

		var eq_y1 = 0;
		var eq_y2 = 0;

		if (x2 == x1) {
 
			a = 1;

			b = -2 * y1;

			c = y1 * y1 - scale_length_pow;

			eq_x1 = x1;
			eq_x1 = x2;
 

			eq_y1 = (-b + Math.sqrt(b * b - (4 * a * c))) / (2 * a);
			eq_y1 = Number(eq_y1).toFixed(2);
			eq_y2 = (-b - Math.sqrt(b * b - (4 * a * c))) / (2 * a);
			eq_y2 = Number(eq_y2).toFixed(2);

		} else {
 

			var eq1_slope = (y2 - y1) / (x2 - x1); 

			a = 1 + eq1_slope * eq1_slope;

			b = -2 * x1 - 2 * eq1_slope * eq1_slope * x1;

			c = x1 * x1 + eq1_slope * eq1_slope * x1 * x1 - scale_length_pow; 

			eq_x1 = (-b + Math.sqrt(b * b - (4 * a * c))) / (2 * a);
			eq_x1 = Number(eq_x1).toFixed(2);
			eq_x2 = (-b - Math.sqrt(b * b - (4 * a * c))) / (2 * a);
			eq_x2 = Number(eq_x2).toFixed(2);

			var eq1_slope = (y2 - y1) / (x2 - x1);

			eq_y1 = (eq1_slope * eq_x1) - (eq1_slope * x1) + Number(y1);
			eq_y2 = (eq1_slope * eq_x2) - (eq1_slope * x1) + Number(y1);

		}
 
  		if(x2 >= x1){
  			return {
  					x : eq_x1,
  					y : eq_y1
  				}; 
  		}else{
  			return {
  					x : eq_x2,
  					y : eq_y2
  				}; 
  		}

	}

	var distants_on_two_point = function(p_point1, p_point2) {

		var x1 = Number(p_point1.x);
		var y1 = Number(p_point1.y);

		var x2 = Number(p_point2.x);
		var y2 = Number(p_point2.y);

		var d = (x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1);
		return Math.sqrt(d);
	};

	var target_y_on_two_point_line = function(p_point1, p_point2, p_target_x) {

		var x1 = Number(p_point1.x);
		var y1 = Number(p_point1.y);

		var x2 = Number(p_point2.x);
		var y2 = Number(p_point2.y);

		if (x1 == x2) {

			if (x1 == p_target_x) {

				return "all";

			} else {

				return "not";

			}

		} else if (y1 == y2) {

			return "all";

		} else {

			var y = ((y2 - y1) / (x2 - x1)) * (p_target_x - x1) + y1;

			return y;
		}
	};

	var scale_element_data = function(p_center, p_element, p_ratio) {

		var element_clone = $.extend(true, {}, p_element);

		p_element.start = get_point_by_ratio(p_center, p_element.start, p_ratio);
		p_element.end = get_point_by_ratio(p_center, p_element.end, p_ratio);

		var data = p_element.data;

		for ( var data_index in data) {

			var step_data = data[data_index];

			if (p_element.type == "path") {

				if (data_index == 0) {

					var p_target = {
						x : step_data[1],
						y : step_data[2]
					};

					p_target = get_point_by_ratio(p_center, p_target, p_ratio);

					step_data[1] = p_target.x;
					step_data[2] = p_target.y;

				} else {

					if (step_data[0] == "L") {

						var p_target = {
							x : step_data[1],
							y : step_data[2]
						};

						p_target = get_point_by_ratio(p_center, p_target,
								p_ratio);

						step_data[1] = p_target.x;
						step_data[2] = p_target.y;

					} else if (step_data[0] == "H") {

						var p_target = {
							x : step_data[1],
							y : element_clone.start.y
						};

						p_target = get_point_by_ratio(p_center, p_target,
								p_ratio);

						step_data[1] = p_target.x;

					} else if (step_data[0] == "V") {

						var p_target = {
							x : element_clone.start.x,
							y : step_data[1]
						};

						p_target = get_point_by_ratio(p_center, p_target,
								p_ratio);

						step_data[1] = p_target.y;

					} else if (step_data[0] == "C") {

						var p_target = {
							x : step_data[1],
							y : step_data[2]
						};

						p_target = get_point_by_ratio(p_center, p_target,
								p_ratio);

						step_data[1] = p_target.x;
						step_data[2] = p_target.y;

						p_target = {
							x : step_data[3],
							y : step_data[4]
						};

						p_target = get_point_by_ratio(p_center, p_target,
								p_ratio);

						step_data[3] = p_target.x;
						step_data[4] = p_target.y;

						p_target = {
							x : step_data[5],
							y : step_data[6]
						};

						p_target = get_point_by_ratio(p_center, p_target,
								p_ratio);

						step_data[5] = p_target.x;
						step_data[6] = p_target.y;

					} else if (step_data[0] == "S") {

						var p_target = {
							x : step_data[1],
							y : step_data[2]
						};

						p_target = get_point_by_ratio(p_center, p_target,
								p_ratio);

						step_data[1] = p_target.x;
						step_data[2] = p_target.y;

						p_target = {
							x : step_data[3],
							y : step_data[4]
						};

						p_target = get_point_by_ratio(p_center, p_target,
								p_ratio);

						step_data[3] = p_target.x;
						step_data[4] = p_target.y;

					} else if (step_data[0] == "Q") {

						var p_target = {
							x : step_data[1],
							y : step_data[2]
						};

						p_target = get_point_by_ratio(p_center, p_target,
								p_ratio);

						step_data[1] = p_target.x;
						step_data[2] = p_target.y;

						p_target = {
							x : step_data[3],
							y : step_data[4]
						};

						p_target = get_point_by_ratio(p_center, p_target,
								p_ratio);

						step_data[3] = p_target.x;
						step_data[4] = p_target.y;

					} else if (step_data[0] == "T") {

						var p_target = {
							x : step_data[1],
							y : step_data[2]
						};

						p_target = get_point_by_ratio(p_center, p_target,
								p_ratio);

						step_data[1] = p_target.x;
						step_data[2] = p_target.y;

					} else if (step_data[0] == "A") {
						console.log("A _____");
					} else if (step_data[0] == "Z") {
						console.log("A _____");
					}

					//R += " ";
					//R += "z";
				}

			} else if (p_element.type == "line") {

				if (data_index == 0) {

					var p_target = {
						x : step_data[1],
						y : step_data[2]
					};

					p_target = get_point_by_ratio(p_center, p_target, p_ratio);

					step_data[1] = p_target.x;
					step_data[2] = p_target.y;

				} else {

					var p_target = {
						x : step_data[1],
						y : step_data[2]
					};

					p_target = get_point_by_ratio(p_center, p_target, p_ratio);

					step_data[1] = p_target.x;
					step_data[2] = p_target.y;

				}

			}

			data[data_index] = step_data;

		} // for ( var data_index in data) { 

		p_element.data = data;

		return p_element;
	};

	var move_element_data = function(p_element, p_move_gap) {
		
		var x_gap =  Number(p_move_gap.x);
		var y_gap =  Number(p_move_gap.y);
		
		var start_name = p_element.start.name;
		var start_x = Number(p_element.start.x) + x_gap;
		var start_y = Number(p_element.start.y) + y_gap; 
		
		var end_name = p_element.end.name;
		var end_x = Number(p_element.end.x) + x_gap;
		var end_y = Number(p_element.end.y) + y_gap; 
		
		var R = {};
		R.start = {};
		R.start.x = start_x;
		R.start.y = start_y;
		R.start.name = start_name; 
		R.end = {};
		R.end.x = end_x;
		R.end.y = end_y;
		R.end.name = end_name;
 		R.type = p_element.type;
		
		var data = p_element.data;
		
		for ( var data_index in data) {

			var step_data = data[data_index]; 
			if (p_element.type == "path") {

				if (data_index == 0) {

					step_data[1] = Number(step_data[1]) + x_gap;
					step_data[2] = Number(step_data[2]) + y_gap;

				} else {

					if (step_data[0] == "L") {

						step_data[1] = Number(step_data[1]) + x_gap;
						step_data[2] = Number(step_data[2]) + y_gap;

					} else if (step_data[0] == "H") {

						step_data[1] = Number(step_data[1]) + x_gap; 

					} else if (step_data[0] == "V") { 
						step_data[1] = Number(step_data[1]) + y_gap;

					} else if (step_data[0] == "C") {

						step_data[1] = Number(step_data[1]) + x_gap;
						step_data[2] = Number(step_data[2]) + y_gap;
						step_data[3] = Number(step_data[3]) + x_gap;
						step_data[4] = Number(step_data[4]) + y_gap;
						step_data[5] = Number(step_data[5]) + x_gap;
						step_data[6] = Number(step_data[6]) + y_gap;

					} else if (step_data[0] == "S") {

						step_data[1] = Number(step_data[1]) + x_gap;
						step_data[2] = Number(step_data[2]) + y_gap;
						step_data[3] = Number(step_data[3]) + x_gap;
						step_data[4] = Number(step_data[4]) + y_gap;

					} else if (step_data[0] == "Q") {

						step_data[1] = Number(step_data[1]) + x_gap;
						step_data[2] = Number(step_data[2]) + y_gap;
						step_data[3] = Number(step_data[3]) + x_gap;
						step_data[4] = Number(step_data[4]) + y_gap;

					} else if (step_data[0] == "T") {

						step_data[1] = Number(step_data[1]) + x_gap;
						step_data[2] = Number(step_data[2]) + y_gap;

					} else if (step_data[0] == "A") {
						console.log("A _____");
					} else if (step_data[0] == "Z") {
						console.log("A _____");
					}

					//R += " ";
					//R += "z";
				}

			} else if (p_element.type == "line") {

				if (data_index == 0) {

					step_data[1] = Number(step_data[1]) + x_gap;
					step_data[2] = Number(step_data[2]) + y_gap;

				} else {

					step_data[1] = Number(step_data[1]) + x_gap;
					step_data[2] = Number(step_data[2]) + y_gap;

				}

			}

			data[data_index] = step_data;

		} // for ( var data_index in data) { 

 
		R.data = data;
		return R;

	}

	var flat_element_data = function(p_element) {
		console.log("flat_element_data  ");
		var flat_R = "";

		var data = p_element.data;
		console.dir(p_element);
		
		for (var data_index in data) {

			var step_data = data[data_index];
			console.log("data_index : "+data_index);
			console.dir(step_data);

			if (p_element.type == "path") {

				if (data_index == 0) {

					flat_R = "M";
					flat_R += step_data[1];
					flat_R += " ";
					flat_R += step_data[2];
					flat_R += " ";

				} else {

					if (step_data[0] == "L") {

						flat_R += "L";
						flat_R += " ";
						flat_R += step_data[1];
						flat_R += " ";
						flat_R += step_data[2];

					} else if (step_data[0] == "H") {

						flat_R += "H";
						flat_R += " ";
						flat_R += step_data[1];

					} else if (step_data[0] == "V") {

						flat_R += "V";
						flat_R += " ";
						flat_R += step_data[1];

					} else if (step_data[0] == "C") {

						flat_R += "C";
						flat_R += " ";
						flat_R += step_data[1];
						flat_R += " ";
						flat_R += step_data[2];
						flat_R += ",";
						flat_R += step_data[3];
						flat_R += " ";
						flat_R += step_data[4];
						flat_R += ",";
						flat_R += step_data[5];
						flat_R += " ";
						flat_R += step_data[6];

					} else if (step_data[0] == "S") {

						flat_R += "S";
						flat_R += " ";
						flat_R += step_data[1];
						flat_R += " ";
						flat_R += step_data[2];
						flat_R += ",";
						flat_R += step_data[3];
						flat_R += " ";
						flat_R += step_data[4];

					} else if (step_data[0] == "Q") {

						flat_R += "Q";
						flat_R += " ";
						flat_R += step_data[1];
						flat_R += " ";
						flat_R += step_data[2];
						flat_R += ",";
						flat_R += step_data[3];
						flat_R += " ";
						flat_R += step_data[4];

					} else if (step_data[0] == "T") {

						flat_R += "T";
						flat_R += " ";
						flat_R += step_data[1];
						flat_R += " ";
						flat_R += step_data[2];

					} else if (step_data[0] == "A") {
						console.log("A _____");
					} else if (step_data[0] == "Z") {
						console.log("A _____");
					}

					//flat_R += " ";
					//flat_R += "z";
				}

			} else if (p_element.type == "line") {

				if (data_index == 0) {

					/* flat_R = [];
					flat_R.push(step_data[1]);
					flat_R.push(step_data[2]); */

					flat_R = "";
					flat_R += step_data[1];
					flat_R += ",";
					flat_R += step_data[2];

				} else {
					/* flat_R.push(step_data[3]);
					flat_R.push(step_data[4]); */

					flat_R = " ";
					flat_R += step_data[1];
					flat_R += ",";
					flat_R += step_data[2];

				}

			}
		}

		console.log(flat_R);

		return flat_R;

	};

	var mi_exe = function(p_target, p_op) {
		alert(p_target + " " + p_op);
	};
</script>
<style>
#MAIN_CANVAS {
	width: 900px;
	height: 900px;
	border: 1px solid black;
}

#maintable {
	width: 100%;
	height: 100%;
}

#back_green {
	background-color: green;
}
</style>
</head>
<body>
 <h1>컨트롤러 시뮬레이터</h1>
 <a href="dynamic_model_builder.html" target="_blank">수치 모델 빌더</a>
 <a href="http://jsbeautifier.org" target="_blank">beautifier</a>
 <a href="http://jsonviewer.stack.hu" target="_blank">jsonviewer</a>
 <table id="maintable">
  <tr>
   <td>
    <div>
     X 축 : <input type="text" id="center_x" value="450" /> Y 축 : <input type="text" id="center_y" value="450" /> 비율 : <input type="text" id="center_ratio" value="1" />
     <button onclick="move_center();">중심축이동</button>
     <br>
    </div>
    <div id="MAIN_CANVAS"></div>
   </td>
   <td>
    <h3>수치모델 입력</h3>
    <button onclick="import_model();">불러들이기</button> <textarea id="input_dm" cols="135" rows="5"></textarea>
    <h3>수치모델 출력</h3>
    <button onclick="export_model();">내보내기</button> <textarea id="output_dm" cols="135" rows="5"></textarea>
    <h3>controller</h3> <textarea id="input_ctrl" cols="135" rows="10"></textarea>
    <h3>측정항목</h3>
    <div>
     이름 : <input type="text" id="mi_name_1" /> min : <input type="text" id="mi_min_1"> max : <input type="text" id="mi_max_1"> now : <input type="text" id="mi_now_1">
     <button onclick="mi_exe('1','up')">△</button>
     <button onclick="mi_exe('1','down')">▽</button>
     <br> 이름 : <input type="text" id="mi_name_2" /> min : <input type="text" id="mi_min_2"> max : <input type="text" id="mi_max_2"> now : <input type="text" id="mi_now_2">
     <button onclick="mi_exe('2','up')">△</button>
     <button onclick="mi_exe('2','down')">▽</button>
     <br> 이름 : <input type="text" id="mi_name_3" /> min : <input type="text" id="mi_min_3"> max : <input type="text" id="mi_max_3"> now : <input type="text" id="mi_now_3">
     <button onclick="mi_exe('3','up')">△</button>
     <button onclick="mi_exe('3','down')">▽</button>
     <br> 이름 : <input type="text" id="mi_name_4" /> min : <input type="text" id="mi_min_4"> max : <input type="text" id="mi_max_4"> now : <input type="text" id="mi_now_4">
     <button onclick="mi_exe('4','up')">△</button>
     <button onclick="mi_exe('4','down')">▽</button>
     <br> 이름 : <input type="text" id="mi_name_5" /> min : <input type="text" id="mi_min_5"> max : <input type="text" id="mi_max_5"> now : <input type="text" id="mi_now_5">
     <button onclick="mi_exe('5','up')">△</button>
     <button onclick="mi_exe('5','down')">▽</button>
     <br> 이름 : <input type="text" id="mi_name_6" /> min : <input type="text" id="mi_min_6"> max : <input type="text" id="mi_max_6"> now : <input type="text" id="mi_now_6">
     <button onclick="mi_exe('6','up')">△</button>
     <button onclick="mi_exe('6','down')">▽</button>
     <br> 이름 : <input type="text" id="mi_name_7" /> min : <input type="text" id="mi_min_7"> max : <input type="text" id="mi_max_7"> now : <input type="text" id="mi_now_6">
     <button onclick="mi_exe('6','up')">△</button>
     <button onclick="mi_exe('7','down')">▽</button>
     <br> 이름 : <input type="text" id="mi_name_8" /> min : <input type="text" id="mi_min_8"> max : <input type="text" id="mi_max_8"> now : <input type="text" id="mi_now_6">
     <button onclick="mi_exe('6','up')">△</button>
     <button onclick="mi_exe('8','down')">▽</button>
     <br> 이름 : <input type="text" id="mi_name_9" /> min : <input type="text" id="mi_min_9"> max : <input type="text" id="mi_max_9"> now : <input type="text" id="mi_now_6">
     <button onclick="mi_exe('6','up')">△</button>
     <button onclick="mi_exe('9','down')">▽</button>
     <br> 이름 : <input type="text" id="mi_name_10" /> min : <input type="text" id="mi_min_10"> max : <input type="text" id="mi_max_10"> now : <input type="text" id="mi_now_6">
     <button onclick="mi_exe('6','up')">△</button>
     <button onclick="mi_exe('10','down')">▽</button>
     <br>
    </div>
   </td>
  </tr>
 </table>
</body>
</html>